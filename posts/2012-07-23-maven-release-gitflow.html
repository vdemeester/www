<!DOCTYPE html>
<html lang="en">
<head>
<!-- Sep 03, 2024 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Maven Release Gitflow</title>
<meta name="author" content="Vincent Demeester" />
<meta name="generator" content="Org Mode" />
<link rel='icon' type='image/x-icon' href='/images/favicon.ico'/>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel='stylesheet' href='/css/new.css' type='text/css'/>
<link rel='stylesheet' href='/css/syntax.css' type='text/css'/>
<link href='/index.xml' rel='alternate' type='application/rss+xml' title='Vincent Demeester' />
</head>
<body>
<main id="content" class="content">
<header>
<h1 class="title">Maven Release Gitflow</h1>
</header><section id="outline-container-Introduction" class="outline-2">
<h2 id="Introduction">Introduction</h2>
<div class="outline-text-2" id="text-Introduction">
<p>
I like a lot the <a href="http://nvie.com/posts/a-successful-git-branching-model/">gitflow</a> way of managing project. When working on maven project, there is
few great plugins that helps to get the work done. One of them is <a href="http://maven.apache.org/plugins/maven-release-plugin">maven-release-plugin</a>.
</p>

<p>
Inspired on this <a href="https://gist.github.com/1043970">gist</a>, I&rsquo;ve come
with a cool way of doing things (let say we want to release a 0.1
version of an artifact) :
</p>
</div>
</section>
<section id="outline-container-prepare-the-pom.xml." class="outline-2">
<h2 id="prepare-the-pom.xml.">Prepare the pom.xml.</h2>
<div class="outline-text-2" id="text-prepare-the-pom.xml.">
<p>
It needs <code>&lt;scm&gt;</code> entries, <code>&lt;distributionManagement&gt;</code> entries (to know
where to deploy the release artifact) and few options for the
maven-release-plugin :
</p>

<p>
{{&lt; highlight xml &gt;}}
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;project&gt;

    &lt;!-- […] --&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;!-- […] --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.3.2&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;tagNameFormat&gt;v@{project.version}&lt;/tagNameFormat&gt;
                    &lt;pushChanges&gt;false&lt;/pushChanges&gt;
                    &lt;localCheckout&gt;true&lt;/localCheckout&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;!-- […] --&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
    &lt;!-- […] --&gt;

&lt;/project&gt;
</pre>
</div>

<p>
Few explanation here :
</p>

<ul class="org-ul">
<li><code>tagNameFormat</code> is here to change the default tag name (which is
<code>${project.artifactId}-${project.version}</code>) to a better one.</li>
<li><code>pushChanges</code> set to <code>false</code> tells maven-release-plugin not to push
changes (this will become useful)</li>
<li><code>localCheckout</code> set to <code>true</code> tells maven-release-plugin to clone from
local repository (not distant). This is especially useful here because
we didn&rsquo;t push anything (so not setting this option would result in a
failure).</li>
</ul>
</div>
</section>
<section id="outline-container-the-real-stuff" class="outline-2">
<h2 id="the-real-stuff">The real stuff</h2>
<div class="outline-text-2" id="text-the-real-stuff">
<p>
First create a release branch from develop.
</p>

<div class="org-src-container">
<pre class="src src-bash">$ git checkout -b release/v0.1 develop
</pre>
</div>

<p>
Then run the maven release stuff.
</p>

<div class="org-src-container">
<pre class="src src-bash">$ mvn release:prepare               # change the pom, commit and tag version, and
                                    # re-change pom (by incrementing SNAPSHOT version)
$ mvn release:perform               # get the tagged version, compile and deploy
</pre>
</div>

<p>
And the real fun begins.
</p>

<div class="org-src-container">
<pre class="src src-bash">$ git checkout develop              # get back to the develop branch
$ git merge --no-ff release/v0.1    # merge the version back into develop
$ git checkout master               # go to the master branch
$ git merge --no-ff release/v0.1~1  # merge the version back into master but
                                    # the tagged version instead of the release/v0.1 HEAD
$ git branch -D release/v0.1        # Removing the release branch
$ git push --all &amp;&amp; git push --tags # Finally push everything
</pre>
</div>

<p>
The real magic here is the <code>git merge --no-ff release/v0.1~1</code> which will
merge into master the commit before the HEAD of the branch
<code>release/v0.1</code>.
</p>

<p>
The next step would be to create a helper script that automates this and
verify that the <code>pom.xml</code> has the right configuration options.
</p>

<p>
<b>Edit 17:58</b> : You can take a look <a href="https://github.com/vdemeester/java-config/blob/master/bin/mvn-release-flow">here</a>
</p>
</div>
</section>
</main>
<footer id="postamble" class="status">
<footer>
     <small><a href="/" rel="history">Index</a> • <a href="/sitemap.html">Sitemap</a> • <a href="https://dl.sbr.pm/">Files</a></small><br/>
     <small class='questions'>Questions, comments ? Please use my <a href="https://lists.sr.ht/~vdemeester/public-inbox">public inbox</a> by sending a plain-text email to <a href="mailto:~vdemeester/public-inbox@lists.sr.ht">~vdemeester/public-inbox@lists.sr.ht</a>.</small><br/>
     <small class='copyright'>
      Content and design by Vincent Demeester
      (<a rel='licence' href='http://creativecommons.org/licenses/by-nc-sa/3.0/'>Some rights reserved</a>)
    </small><br />
</footer>
</footer>
</body>
</html>
