<!DOCTYPE html>
<html lang="en">
<head>
<!-- Sep 03, 2024 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Golang testing â€” gotest.tools skip</title>
<meta name="author" content="Vincent Demeester" />
<meta name="generator" content="Org Mode" />
<link rel='icon' type='image/x-icon' href='/images/favicon.ico'/>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel='stylesheet' href='/css/new.css' type='text/css'/>
<link rel='stylesheet' href='/css/syntax.css' type='text/css'/>
<link href='/index.xml' rel='alternate' type='application/rss+xml' title='Vincent Demeester' />
</head>
<body>
<main id="content" class="content">
<header>
<h1 class="title">Golang testing â€” gotest.tools skip</h1>
</header><section id="outline-container-Introduction" class="outline-2">
<h2 id="Introduction">Introduction</h2>
<div class="outline-text-2" id="text-Introduction">
<p>
Let&rsquo;s continue the <a href="https://gotest.tools"><code>gotest.tools</code></a> serie, this time with the <code>skip</code> package. This is a
really simple one so this should be quick.
</p>

<blockquote>
<p>
<code>skip</code> provides functions for skipping a test and printing the source code of the
condition used to skip the test.
</p>
</blockquote>

<p>
The package consists of only one function : <code>If</code>. The idea comes mainly from
<a href="https://github.com/docker/docker"><code>docker/docker</code></a> integration test suite, where we wanted to skip some test (or test suites)
given different context. By context I mean things like the system we are running on
(<code>Windows</code>, <code>Linux</code>, â€¦) or the capabilities of the running kernel or node (is <code>apparmor</code>
available or not on the current machine).
</p>

<p>
This <code>If</code> method takes a <code>testing.T</code> pointer and either a boolean, a function that
returns a boolean, <b>or</b> an expression.
</p>

<div class="org-src-container">
<pre class="src src-go">// boolean
//   --- SKIP: TestName (0.00s)
//           skip.go:19: MissingFeature
var MissingFeature bool
skip.If(t, MissingFeature)

// function
//   --- SKIP: TestName (0.00s)
//           skip.go:19: !IsExperimentalDaemon(dockerClient): daemon is not experimental
skip.If(t, IsExperimentalDaemon(dockerClient), "daemon is not experimental")

// expression
//   --- SKIP: TestName (0.00s)
//           skip.go:19: apiVersion &lt; version("v1.24")
skip.If(t, apiVersion &lt; version("v1.24"))
</pre>
</div>

<p>
There is few elements to note though :
</p>

<ul class="org-ul">
<li>This package (as other parts of the <code>gotest.tools</code> packages), will try to look at source
files to display the expression used (same goes for <code>assert</code>). This is usually not a
problem because you run tests where the source code is. <b>However</b>, in the cases you
generate a test binary to be executed later (Ã -la <code>kubernetes</code> or other projects), this
can display a weird error message if the sources are not availableâ€¦ You shouldn&rsquo;t be
worried too much about it, but it&rsquo;s better if you know :)</li>
<li>The main reason to use <code>skip.If</code> is mainly for new contributors to get in quickly,
<b>reducing potential friction of them running the tests on their environment</b>. The more
the tests are written in a way they explicitely declare their requirements (and skipped
if the environment does not meet those), the easier it makes contributors run your
tests. <b>But</b>, this also means, you should try to measure the skipped tests on your
continuous integration system to make sure you run all of them eventuallyâ€¦ otherwise
it&rsquo;s dead code. <i>But more on that in later posts ðŸ˜‰</i>.</li>
</ul>

<p>
That&rsquo;s all for today folks, told you that was going to be quick.
</p>
</div>
</section>
</main>
<footer id="postamble" class="status">
<footer>
     <small><a href="/" rel="history">Index</a> â€¢ <a href="/sitemap.html">Sitemap</a> â€¢ <a href="https://dl.sbr.pm/">Files</a></small><br/>
     <small class='questions'>Questions, comments ? Please use my <a href="https://lists.sr.ht/~vdemeester/public-inbox">public inbox</a> by sending a plain-text email to <a href="mailto:~vdemeester/public-inbox@lists.sr.ht">~vdemeester/public-inbox@lists.sr.ht</a>.</small><br/>
     <small class='copyright'>
      Content and design by Vincent Demeester
      (<a rel='licence' href='http://creativecommons.org/licenses/by-nc-sa/3.0/'>Some rights reserved</a>)
    </small><br />
</footer>
</footer>
</body>
</html>
