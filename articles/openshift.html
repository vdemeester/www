<!DOCTYPE html>
<html lang="en">
<head>
<!-- Sep 03, 2024 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OpenShift</title>
<meta name="author" content="Vincent Demeester" />
<meta name="generator" content="Org Mode" />
<link rel='icon' type='image/x-icon' href='/images/favicon.ico'/>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel='stylesheet' href='/css/new.css' type='text/css'/>
<link rel='stylesheet' href='/css/syntax.css' type='text/css'/>
<link href='/index.xml' rel='alternate' type='application/rss+xml' title='Vincent Demeester' />
</head>
<body>
<main id="content" class="content">
<header>
<h1 class="title">OpenShift</h1>
</header><p>
It is primarily built by <a href="red_hat.html">Red Hat</a>.
</p>
<section id="outline-container-Projects%20around%20OpenShift" class="outline-2">
<h2 id="Projects%20around%20OpenShift">Projects around OpenShift</h2>
<div class="outline-text-2" id="text-Projects%20around%20OpenShift">
<ul class="org-ul">
<li><a href="openshift_pipeline.html">OpenShift Pipeline</a></li>
</ul>
</div>
</section>
<section id="outline-container-Provisioning" class="outline-2">
<h2 id="Provisioning">Provisioning</h2>
<div class="outline-text-2" id="text-Provisioning">
<p>
One of my goal is to have a local OpenShift cluster that I use daily â€” I really like the
idea of <a href="dogfooding.html">dogfooding</a>. There is multiple ways to provision OpenShift, but as we are going to
run it locally (because it costs less ðŸ™ƒ), we are going to try to using <code>libvirt</code> and the
<a href="https://github.com/openshift/installer/">installer</a> <i>or</i> on bare metal. Note that we can use the <i>bare metal</i> setup on libvirt
virtual machines that are managed outside of the OpenShift scope using the <a href="https://github.com/openshift/installer/blob/master/docs/user/metal/install_upi.md">User Provided
Infrastructure</a>. Let&rsquo;s try this : <a href="openshift_on_vm_bare_metal.html">OpenShift on VM Bare metal</a>.
</p>

<p>
For OpenShift, I&rsquo;ll stick with <a href="red_hat.html">Red Hat</a> usual setup, aka using CentOS or RHEL ðŸ˜‰.
</p>
</div>
</section>
<section id="outline-container-Identity%20providers" class="outline-2">
<h2 id="Identity%20providers">Identity providers</h2>
<div class="outline-text-2" id="text-Identity%20providers">
<blockquote>
<p>
For users to interact with OpenShift Container Platform, they must first authenticate to
the cluster. The authentication layer identifies the user associated with requests to the
OpenShift Container Platform API. The authorization layer then uses information about the
requesting user to determine if the request is allowed.
</p>

<p>
[â€¦]
</p>

<p>
The OpenShift Container Platform master includes a built-in OAuth server. Developers and
administrators obtain OAuth access tokens to authenticate themselves to the API.
</p>
</blockquote>

<p>
Identity providers are the way to create user in an OpenShift cluster. There is a bunch
that exists, but we will only look at the following.
</p>

<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#HTPasswd">HTPasswd</a></li>
<li><a href="#GitHub">GitHub</a></li>
<li><a href="#GitLab">GitLab</a></li>
</ul>
</div>
</div>
<div id="outline-container-HTPasswd" class="outline-3">
<h3 id="HTPasswd">HTPasswd</h3>
<div class="outline-text-3" id="text-HTPasswd">
</div>
<div id="outline-container-create" class="outline-4">
<h4 id="create">create</h4>
<div class="outline-text-4" id="text-create">
<blockquote>
<p>
Configure the htpasswd identity provider to validate user names and passwords against a
flat file generated using htpasswd.
</p>
</blockquote>

<ul class="org-ul">
<li><p>
Create or update your flat file with a user name and hashed password:
</p>
<div class="org-src-container">
<pre class="src src-bash">$ htpasswd -c -B -b &lt;/path/to/users.htpasswd&gt; &lt;user_name&gt; &lt;password&gt;
</pre>
</div></li>

<li><p>
Create the htpasswd secret
</p>
<div class="org-src-container">
<pre class="src src-bash">$ oc create secret generic htpass-secret --from-file=htpasswd=&lt;/path/to/users.htpasswd&gt; -n openshift-config
</pre>
</div></li>

<li><p>
Create an HTPasswd CR
</p>
<div class="org-src-container">
<pre class="src src-yaml">apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: my_htpasswd_provider
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpass-secret
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-update" class="outline-4">
<h4 id="update">update</h4>
<div class="outline-text-4" id="text-update">
<p>
In order to update the users of an htpasswd identity provider:
</p>

<ul class="org-ul">
<li><p>
Get the secret content
</p>
<div class="org-src-container">
<pre class="src src-bash">$ oc get secret htpass-secret -ojsonpath={.data.htpasswd} -n openshift-config | base64 -d &gt; users.htpasswd
</pre>
</div></li>
<li><p>
Add or remove a user
</p>
<div class="org-src-container">
<pre class="src src-bash"># Add
$ htpasswd -bB users.htpasswd &lt;username&gt; &lt;password&gt;
# Remove
$ htpasswd -D users.htpasswd &lt;username&gt;
</pre>
</div></li>
<li><p>
Replace the <code>htpass-secret</code>
</p>
<div class="org-src-container">
<pre class="src src-bash">$ oc create secret generic htpass-secret --from-file=htpasswd=users.htpasswd --dry-run -o yaml -n openshift-config | oc replace -f -
</pre>
</div></li>
<li><p>
<i>note:</i> If you removed one or more users, you must additionally remove existing resources
for each user.
</p>
<div class="org-src-container">
<pre class="src src-bash"># Delete the user
$ oc delete user &lt;username&gt;
# Delete the user identity
$ oc delete identity my_htpasswd_provider:&lt;username&gt;
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-GitHub" class="outline-3">
<h3 id="GitHub">GitHub</h3>
<div class="outline-text-3" id="text-GitHub">
<blockquote>
<p>
Configure a github identity provider to validate user names and passwords against GitHub
or GitHub Enterpriseâ€™s OAuth authentication server.
</p>
</blockquote>

<p>
See <a href="https://docs.openshift.com/container-platform/4.5/authentication/identity_providers/configuring-github-identity-provider.html">Configuring a GitHub or GitHub Enterprise identity provider - Configuring identity providers | Authentication and authorization | OpenShift Container Platform 4.5</a>.
</p>
</div>
</div>
<div id="outline-container-GitLab" class="outline-3">
<h3 id="GitLab">GitLab</h3>
<div class="outline-text-3" id="text-GitLab">
<blockquote>
<p>
Configure a gitlab identity provider to use GitLab.com or any other GitLab instance as an
identity provider.
</p>
</blockquote>

<p>
See <a href="https://docs.openshift.com/container-platform/4.5/authentication/identity_providers/configuring-gitlab-identity-provider.html#configuring-gitlab-identity-provider">Configuring a GitLab identity provider - Configuring identity providers | Authentication and authorization | OpenShift Container Platform 4.5</a>.
</p>
</div>
</div>
</section>
</main>
<footer id="postamble" class="status">
<footer>
     <small><a href="/" rel="history">Index</a> â€¢ <a href="/sitemap.html">Sitemap</a> â€¢ <a href="https://dl.sbr.pm/">Files</a></small><br/>
     <small class='questions'>Questions, comments ? Please use my <a href="https://lists.sr.ht/~vdemeester/public-inbox">public inbox</a> by sending a plain-text email to <a href="mailto:~vdemeester/public-inbox@lists.sr.ht">~vdemeester/public-inbox@lists.sr.ht</a>.</small><br/>
     <small class='copyright'>
      Content and design by Vincent Demeester
      (<a rel='licence' href='http://creativecommons.org/licenses/by-nc-sa/3.0/'>Some rights reserved</a>)
    </small><br />
</footer>
</footer>
</body>
</html>
