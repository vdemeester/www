<!DOCTYPE html>
<html lang="en">
<head>
<!-- Oct 07, 2022 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kubernetes on NixOS</title>
<meta name="author" content="Vincent Demeester" />
<meta name="generator" content="Org Mode" />
<link rel='icon' type='image/x-icon' href='/images/favicon.ico'/>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel='stylesheet' href='/css/new.css' type='text/css'/>
<link rel='stylesheet' href='/css/syntax.css' type='text/css'/>
<link href='/index.xml' rel='alternate' type='application/rss+xml' title='Vincent Demeester' />
</head>
<body>
<main id="content" class="content">
<header>
<h1 class="title">Kubernetes on NixOS</h1>
</header><p>
This document will serve to document the way I setup my own little personal kubernetes
cluster on NixOS. I am using virtual machines for this (as of today) because it is simpler
to use, and as for <a href="microk8s.html">microk8s</a> document, I rely on the fact that my network setup is capable
of assigning a predefined IP to a given mac address.
</p>

<section id="outline-container-Why%20Kubernetes%20at%20home%20%3F" class="outline-2">
<h2 id="Why%20Kubernetes%20at%20home%20%3F">Why Kubernetes at home ?</h2>
<div class="outline-text-2" id="text-Why%20Kubernetes%20at%20home%20%3F">
<p>
The first question that can come to mind is &ldquo;why the hell do you want to setup a
kubernetes cluster at home&rdquo; ? And… that&rsquo;s a valid question.
</p>

<p>
I work daily on Kubernetes and OpenShift, and on a CI/CD tooling that I want to be as
useful as possible. If I don&rsquo;t use it myself, what the hell am I doing right ? That&rsquo;s the
main reason why setuping a Kubernetes (and of course <a href="https://tekton.dev">Tekton</a> on it) — gaining operational
knowledge, find the gap and enhancements, …
</p>
</div>
</section>

<section id="outline-container-Bootstrap%20the%20cluster" class="outline-2">
<h2 id="Bootstrap%20the%20cluster">Bootstrap the cluster</h2>
<div class="outline-text-2" id="text-Bootstrap%20the%20cluster">
<p>
How big should the cluster be ? 3 nodes or 5 nodes ?
Let&rsquo;s start with 3, and figure the rest out.
</p>

<p>
We need to do the following to boostrap the cluster:
</p>
<ul class="org-ul">
<li>Configure the network to allocate a set of IP for a set a MAC address</li>
<li>Create VMs images (<code>qcow2</code>) with NixOS and the base system on</li>
<li>Create VMs on a remote server libvirt</li>
<li><i>Hopefully</i> enjoy, and <code>ssh</code> onto them in need be</li>
</ul>

<p>
Ideally, the image we build is using the configuration, this means we should, in theory,
use <code>nixos-generate</code> targeting our <i>node</i> configuration, and it should be the exact same thing
used for <code>morph</code>.
</p>

<p>
Once the images are created, we need to copy them to the right host and from there, create
the virtual machine. Ideally, we do this automatically, command-line, …
</p>
</div>
</section>


<section id="outline-container-References" class="outline-2">
<h2 id="References">References</h2>
<div class="outline-text-2" id="text-References">
</div>
<div id="outline-container-%5B%5Bhttps%3A%2F%2Fnixos.wiki%2Fwiki%2FKubernetes%5D%5BKubernetes%20-%20NixOS%20Wiki%5D%5D" class="outline-3">
<h3 id="%5B%5Bhttps%3A%2F%2Fnixos.wiki%2Fwiki%2FKubernetes%5D%5BKubernetes%20-%20NixOS%20Wiki%5D%5D"><a href="https://nixos.wiki/wiki/Kubernetes">Kubernetes - NixOS Wiki</a></h3>
<div class="outline-text-3" id="text-%5B%5Bhttps%3A%2F%2Fnixos.wiki%2Fwiki%2FKubernetes%5D%5BKubernetes%20-%20NixOS%20Wiki%5D%5D">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2020-06-11 Thu 15:25]</span></span>
</p>
</div>
</div>
</section>
</main>
<footer id="postamble" class="status">
<footer>
     <small><a href="/" rel="history">Index</a> • <a href="/sitemap.html">Sitemap</a> • <a href="https://dl.sbr.pm/">Files</a></small><br/>
     <small class='questions'>Questions, comments ? Please use my <a href="https://lists.sr.ht/~vdemeester/public-inbox">public inbox</a> by sending a plain-text email to <a href="mailto:~vdemeester/public-inbox@lists.sr.ht">~vdemeester/public-inbox@lists.sr.ht</a>.</small><br/>
     <small class='copyright'>
      Content and design by Vincent Demeester
      (<a rel='licence' href='http://creativecommons.org/licenses/by-nc-sa/3.0/'>Some rights reserved</a>)
    </small><br />
</footer>
</footer>
</body>
</html>
