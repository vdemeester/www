<!DOCTYPE html>
<html lang="en">
<head>
<!-- Sep 03, 2024 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>emacs: keep it clean</title>
<meta name="author" content="Vincent Demeester" />
<meta name="generator" content="Org Mode" />
<link rel='icon' type='image/x-icon' href='/images/favicon.ico'/>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<link rel='stylesheet' href='/css/new.css' type='text/css'/>
<link rel='stylesheet' href='/css/syntax.css' type='text/css'/>
<link href='/index.xml' rel='alternate' type='application/rss+xml' title='Vincent Demeester' />
</head>
<body>
<main id="content" class="content">
<header>
<h1 class="title">emacs: keep it clean</h1>
</header><p>
I want to keep the <code>~/.emacs.d</code> folder as clean as possible. The <a href="https://github.com/emacscollective/no-littering">no-littering</a> project
helps wit that.
</p>

<blockquote>
<p>
The default paths used to store configuration files and persistent data are not consistent
across Emacs packages. This isn&rsquo;t just a problem with third-party packages but even with
built-in packages.
</p>

<p>
Some packages put these files directly in user-emacs-directory or $HOME or in a
subdirectory of either of the two or elsewhere. Furthermore sometimes file names are used
that don&rsquo;t provide any insight into what package might have created them.
</p>

<p>
This package sets out to fix this by changing the values of path variables to put
configuration files in no-littering-etc-directory (defaulting to ~/.emacs.d/etc/) and
persistent data files in no-littering-var-directory (defaulting to ~/.emacs.d/var/), and
by using descriptive file names and subdirectories when appropriate. This is similar to a
color-theme; a &ldquo;path-theme&rdquo; if you will.
</p>
</blockquote>

<p>
Let&rsquo;s configure it <b>and</b> make sure we load it as soon as possible (hence the
<code>config/00-clean.el</code>).
</p>

<p>
As I am loading <code>recentf</code> during this cleanup part, I need to setup recentf before ðŸ˜…. In
a gist:
</p>

<ul class="org-ul">
<li>I keep about 200 items.</li>
<li>I don&rsquo;t want the <i>auto-cleanup</i> of recentf items to happen when the mode is loaded (a.k.a.
at startup). It is configured to run after 360s of idle time.</li>
<li>I don&rsquo;t really want to show the Nth number of the items.</li>
<li>I don&rsquo;t want recentf to save remote, <code>su</code> and <code>sudo</code> items (<code>ssh:</code>, <code>sudo:</code>, â€¦)</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; 00-clean.el --- -*- lexical-binding: t; -*-
;;; Commentary:
;;; no-littering and recentf configurations
;;; Note: this file is autogenerated from an org-mode file.
;;; Code:
(use-package recentf
  :config
  (setq recentf-max-saved-items 200
        recentf-auto-cleanup 360
        recentf-show-file-shortcuts-flag nil)
  (recentf-mode 1)
  (add-to-list 'recentf-exclude "^/\\(?:ssh\\|su\\|sudo\\)?:")
  ;; Magic advice to rename entries in recentf when moving files in
  ;; dired.
  (defun rjs/recentf-rename-notify (oldname newname &amp;rest args)
    (if (file-directory-p newname)
        (rjs/recentf-rename-directory oldname newname)
      (rjs/recentf-rename-file oldname newname)))

  (defun rjs/recentf-rename-file (oldname newname)
    (setq recentf-list
          (mapcar (lambda (name)
                    (if (string-equal name oldname)
                        newname
                      oldname))
                  recentf-list))
    recentf-cleanup)

  (defun rjs/recentf-rename-directory (oldname newname)
    ;; oldname, newname and all entries of recentf-list should already
    ;; be absolute and normalised so I think this can just test whether
    ;; oldname is a prefix of the element.
    (setq recentf-list
          (mapcar (lambda (name)
                    (if (string-prefix-p oldname name)
                        (concat newname (substring name (length oldname)))
                      name))
                  recentf-list))
    recentf-cleanup)

  (advice-add 'dired-rename-file :after #'rjs/recentf-rename-notify))

(use-package no-littering               ; Keep .emacs.d clean
  :config
  (require 'recentf)
  (add-to-list 'recentf-exclude no-littering-var-directory)
  (add-to-list 'recentf-exclude no-littering-etc-directory)

  ;; Move this in its own thing
  (setq
   create-lockfiles nil
   delete-old-versions t
   kept-new-versions 6
   kept-old-versions 2
   version-control t)

  (setq
   backup-directory-alist
   `((".*" . ,(no-littering-expand-var-file-name "backup/")))
   auto-save-file-name-transforms
   `((".*" ,(no-littering-expand-var-file-name "auto-save/") t))))

(provide '00-clean)
;;; 00-clean.el ends here
</pre>
</div>
</main>
<footer id="postamble" class="status">
<footer>
     <small><a href="/" rel="history">Index</a> â€¢ <a href="/sitemap.html">Sitemap</a> â€¢ <a href="https://dl.sbr.pm/">Files</a></small><br/>
     <small class='questions'>Questions, comments ? Please use my <a href="https://lists.sr.ht/~vdemeester/public-inbox">public inbox</a> by sending a plain-text email to <a href="mailto:~vdemeester/public-inbox@lists.sr.ht">~vdemeester/public-inbox@lists.sr.ht</a>.</small><br/>
     <small class='copyright'>
      Content and design by Vincent Demeester
      (<a rel='licence' href='http://creativecommons.org/licenses/by-nc-sa/3.0/'>Some rights reserved</a>)
    </small><br />
</footer>
</footer>
</body>
</html>
